<?php
$aCRMCodes = [
 'МРС1-01-02-04-004',
 'МРС1-01-03-04-010',
 'МРС1-01-03-05-011',
 'МРС1-01-04-07-020',
 'МРС1-01-06-03-030',
 'МРС1-01-06-05-032',
 'МРС1-01-07-01-035',
 'МРС1-01-09-02-050',
 'МРС1-01-09-06-054',
 'МРС1-01-11-01-063',
 'МРС1-01-11-03-065',
 'МРС1-01-14-02-085',
 'МРС1-01-14-06-089',
 'МРС1-01-16-03-099',
 'МРС3-10-10-02-430',
 'МРС3-10-14-02-454',
 'МРС3-10-18-02-474',
 'МРС3-10-26-05-517',
 'МРС4-02-05-03-046',
 'МРС6-01-08-01-019',
 'МРС6-01-12-01-031',
 'МРС6-02-04-01-067',
 'МРС6-02-08-03-081',
 'МРС6-02-09-02-083',
 'МРС6-02-10-01-085',
 'МРС6-02-13-03-096',
 'МРС6-02-15-02-101',
 'МРС8-05-02-01-360',
 'МРС8-05-03-02-364',
 'МРС8-05-03-03-365',
 'МРС8-05-05-01-369',
 'МРС8-05-06-02-373',
 'МРС8-05-06-03-374',
 'МРС8-05-07-01-375',
 'МРС8-06-03-02-409',
 'МРС8-06-04-03-413',
 'МРС8-06-05-01-414',
 'МРС8-06-05-02-415',
 'МРС8-06-05-03-416',
 'МРС8-07-02-01-450',
 'МРС8-08-05-02-499',
 'МРС8-09-02-02-523',
 'МРС8-09-02-03-524',
 'МРС8-09-03-03-527',
 'МРС8-09-04-01-528',
 'МРС8-09-04-03-530',
 'НГР1-01-04-10-029',
 'НГР1-01-07-10-059',
 'НГР1-01-08-04-063',
 'НГР1-01-12-05-104',
 'НГР1-01-19-06-168',
 'НГР1-01-19-07-169',
 'НГР1-01-20-03-174',
 'НГР1-01-22-04-191',
 'НГР1-01-22-07-194',
 'НГР1-01-23-01-196',
 'НГР1-01-23-06-201',
 'НГР1-01-24-03-206',
 'НГР1-01-24-04-207',
 'НГР1-01-26-01-218',
 'НГР2-02-15-06-332',
 'НГР2-02-17-05-347',
 'НГР2-02-20-03-369',
 'НГР2-02-23-06-396',
 'НГР2-02-23-07-397',
 'НГР2-02-25-04-410',
 'НГР2-02-26-01-412',
 'НГР3-03-03-05-429',
 'НГР3-03-05-04-444',
 'НГР3-03-05-05-445',
 'НГР3-03-11-06-494',
 'НГР3-03-19-03-555',
 'НГР3-03-20-04-564',
 'НГР3-03-22-07-583',
 'НГР3-03-23-02-586',
 'НГР3-03-23-03-587',
 'НГР3-03-24-01-593',
 'НГР3-03-24-07-599',
 'НГР3-03-25-04-604',
 'НГР3-03-26-02-607',
 'НГР4-04-05-08-651',
 'НГР4-04-07-02-667',
 'НГР4-04-11-03-712',
 'НГР4-04-11-05-714',
 'НГР4-04-14-11-753',
 'НГР4-04-15-06-759',
 'НГР4-04-17-05-780',
 'НГР4-04-19-06-803',
 'НГР4-04-20-11-819',
 'НГР4-04-21-01-820',
 'НГР4-04-21-02-821',
 'НГР4-04-21-10-829',
 'НГР4-04-24-01-853',
 'НГР4-04-24-04-856',
 'НГР4-04-25-07-867',
 'НГР5-05-04-05-911',
 'НГР5-05-05-06-923',
 'НГР5-05-05-07-924',
 'НГР5-05-06-03-931',
 'НГР5-05-11-01-984',
 'НГР5-05-11-09-992',
 'НГР5-05-12-05-999',
 'НГР5-05-20-11-1093',
 'НГР5-05-21-01-1094',
 'НГР5-05-21-02-1095',
 'НГР5-05-21-06-1099',
 'НГР5-05-21-10-1103',
 'НГР5-05-24-03-1129',
 'НГР5-05-24-08-1134',
 'НГР5-05-25-05-1139',
 'НГР5-05-25-07-1141',
 'НГР5-05-26-02-1144',
 'НГР5-05-26-03-1145',
 'НГР5-05-27-08-1158',
 'ОБ1-01-11-08-098',
 'ОБ1-01-24-03-223',
 'ОБ1-01-24-05-225',
 'ОБ1-01-25-02-228',
 'ОБ1-01-25-03-229',
 'ОБ2-01-24-02-222',
 'ОБ2-01-24-03-223',
 'ОБ2-01-24-04-224',
 'ОБ2-01-25-02-228',
 'ОБ3-01-24-02-200',
 'ОБ3-01-24-03-201',
 'ОБ3-01-25-02-206',
 'ОБ3-01-25-03-207',
 'ОБ4-01-04-05-021',
 'ОБ4-01-04-07-023',
 'ОБ4-01-16-03-115',
 'ОБ4-01-17-04-124',
 'ОБ4-01-17-06-126',
 'ОБ4-01-18-03-131',
 'ОБ4-01-18-05-133',
 'ОБ4-01-19-04-140',
 'ОБ4-01-19-06-142',
 'ОБ4-01-21-04-156',
 'ОБ4-01-22-05-165',
 'ОБ4-01-23-03-171',
 'ОБ4-01-23-06-174',
 'ОБ4-01-24-05-181',
 'ОБ5-02-16-04-304',
 'ОБ5-02-19-05-329',
 'ОБ5-02-21-05-345',
 'ОБ5-02-22-03-351',
 'ОБ5-02-22-04-352',
 'ОБ5-02-23-03-359',
 'ОБ7-01-17-05-249',
 'ОБ8-01-15-02-369',
 'ОЗ1-01-13-05-104',
 'ОЗ1-01-18-06-150',
 'ОЗ1-01-21-04-175',
 'ОЗ1-01-21-05-176',
 'ОЗ1-01-21-06-177',
 'ОЗ1-01-25-01-208',
 'ОЗ1-01-25-03-210',
 'ОЗ1-01-25-04-211',
 'ОЗ1-01-25-06-213',
 'ОЗ1-01-25-07-214',
 'ОЗ1-01-25-08-215',
 'ОЗ1-01-25-09-216',
 'ОЗ1-02-24-09-423',
 'ОЗ1-02-25-02-425',
 'ОЗ1-02-25-03-426',
 'ОЗ1-02-25-05-428',
 'ОЗ1-03-04-09-459',
 'ОЗ1-03-07-09-486',
 'ОЗ1-03-13-09-540',
 'ОЗ1-03-19-03-588',
 'ОЗ1-03-20-09-603',
 'ОЗ1-03-23-03-624',
 'ОЗ1-03-23-09-630',
 'ОЗ1-03-25-04-643',
 'ОЗ1-03-25-05-644',
 'ОЗ1-03-25-06-645',
 'ОЗ1-03-25-08-647',
 'ОЗ2-01-02-09-009',
 'ОЗ2-01-03-04-016',
 'ОЗ2-01-04-09-033',
 'ОЗ2-01-05-08-044',
 'ОЗ2-01-05-10-046',
 'ОЗ2-01-05-11-047',
 'ОЗ2-01-07-04-064',
 'ОЗ2-01-07-07-067',
 'ОЗ2-01-09-11-095',
 'ОЗ2-01-10-12-108',
 'ОЗ2-01-11-09-117',
 'ОЗ2-01-12-04-124',
 'ОЗ2-01-12-08-128',
 'ОЗ2-01-13-07-139',
 'ОЗ2-01-14-09-153',
 'ОЗ2-01-14-10-154',
 'ОЗ2-01-14-11-155',
 'ОЗ2-01-15-04-160',
 'ОЗ2-01-15-12-168',
 'ОЗ2-01-16-09-177',
 'ОЗ2-01-18-04-196',
 'ОЗ2-01-18-08-200',
 'ОЗ2-01-19-10-214',
 'ОЗ2-01-19-12-216',
 'ОЗ2-01-20-07-223',
 'ОЗ2-01-21-09-237',
 'ОЗ2-01-21-11-239',
 'ОЗ2-01-22-04-244',
 'ОЗ2-01-22-07-247',
 'ОЗ2-01-23-12-264',
 'ОЗ2-01-24-05-269',
 'ОЗ3-01-23-01-274',
 'ОЗ3-01-23-03-276',
 'ОЗ3-01-23-04-277',
 'ОЗ3-01-24-01-283',
 'ОЗ3-01-24-02-284',
 'ОЗ3-01-24-05-287',
 'ОЗ3-01-24-07-289',
 'ОЗ3-01-24-09-291',
 'ОЗ7-01-25-01-231',
 'ОЗ7-01-25-02-232',
 'ОЗ7-01-25-04-234',
 'ОЗ7-01-25-06-236',
 'ОЗ7-01-25-08-238',
 'ОЗ8-01-04-04-026',
 'ОЗ8-01-24-02-241',
 'ОЗ8-01-24-05-244',
 'ОЗ8-01-24-06-245',
 'ФЛ1-01-14-02-078',
 'ФЛ1-02-10-06-188',
 'ФЛ1-03-19-04-354',
 'ФЛ1-03-22-04-366',
 'ФЛ1-04-06-02-392',
 'ФЛ1-05-12-01-503',
 'ФЛ1-05-22-05-577',
 'ФЛ1-06-12-02-652',
 'ФЛ1-06-12-06-656',
 'ФЛ1-07-12-04-713',
 'ФЛ3-01-01-01-001',
 'ФЛ3-01-01-04-004',
 'ФЛ3-02-01-01-071',
 'ФЛ3-02-01-02-072',
 'ФЛ3-02-01-03-073',
 'ФЛ3-02-01-06-076',
 'ФЛ3-04-02-02-210',
 'ФЛ3-04-04-03-221',
 'ФЛ3-04-08-02-240',
 'ФЛ3-05-02-04-267',
 'ФЛ3-05-02-05-268',
 'ФЛ3-05-03-05-276',
 'ФЛ3-05-03-07-278',
 'ФЛ3-05-05-06-293',
 'ФЛ3-05-09-05-324',
 'ФЛ3-05-11-02-337',
 'ФЛ3-05-12-05-348',
 'ФЛ3-05-12-06-349',
 'ФЛ3-05-13-02-353',
 'ФЛ3-05-13-04-355',
 'ФЛ3-05-14-01-359',
 'ФЛ3-05-16-03-375',
 'ФЛ3-05-17-02-381',
 'ФЛ3-05-17-06-385',
 'ФЛ3-05-19-01-394',
 'ФЛ3-05-19-02-395',
 'ФЛ3-05-19-03-396',
 'ФЛ3-05-19-04-397',
 'ФЛ3-05-19-05-398',
 'ФЛ3-05-19-06-399',
 'ФЛ3-05-19-07-400',
 'ФЛ3-05-21-02-409',
 'ФЛ3-05-21-03-410',
 'ФЛ3-05-21-06-413',
 'ФЛ3-05-22-04-418',
 'ФЛ3-05-22-07-421',
 'ФЛ3-06-01-02-423',
 'ФЛ3-06-01-03-424',
 'ФЛ3-06-02-02-426',
 'ФЛ3-06-02-03-427',
 'ФЛ3-06-11-04-473',
 'ФЛ3-06-11-05-474',
 'ФЛ3-06-12-03-477',
 'ФЛ3-07-01-01-480',
 'ФЛ3-07-01-02-481',
 'ФЛ3-07-01-04-483',
 'ФЛ3-07-02-02-487',
 'ФЛ3-07-02-07-492',
 'ФЛ3-07-12-03-558',
 'ФЛ3-07-14-01-570',
 'ФЛ3-07-14-04-573',
 'ФЛ3-07-14-05-574',
 'ФЛ3-07-14-06-575',
 'ФЛ3-07-15-02-578',
 'ФЛ3-07-15-03-579',
 'ФЛ3-07-15-07-583',
 'ФЛ3-07-18-01-598',
 'ФЛ3-07-18-02-599',
 'ФЛ3-07-18-04-601',
 'ФЛ3-07-18-05-602',
 'ФЛ3-07-18-06-603',
 'ФЛ3-07-18-07-604',
 'ФЛ3-07-19-03-607',
 'ФЛ3-07-22-02-627',
 'ФЛ3-07-22-03-628',
 'ФЛ3-07-22-04-629',
 'ФЛ3-07-22-05-630',
 'ФЛ3-07-22-06-631',
 'ФЛ3-07-22-07-632'
];

$aCompleted = json_decode( file_get_contents('../cron/_data_from_crm/completed.json', true), true);
//die('<pre>' . print_r($aCompleted, true) . '</pre>');



$aIds = [];
foreach($aCompleted as $building){ //die("$building[MountingBeginning] => " . $building['MountingBeginning']);
 foreach((array)$building['Sections']['Section'] as $section){ //die('=> <pre>' . print_r($section, true) . '</pre>');
  foreach((array)$section['Apartments'] as $apartment){
   $aIds[ $apartment['Code'] ] = $apartment['ArticleId'];
  }
 }
}
//die('<pre>' . print_r($aIds, true) . '</pre>');


echo <<<HD
<style>
main{
 display: flex; flex-direction: column	
}

main > *{
 display: flex
}

main > *:not(:last-of-type){
 margin-bottom: 1vmax
}

main > * > div{
 display: flex; flex-direction: column;
 margin-left: 1vmax
}
</style>
<main>

HD;


#< planes
$aPlans = [];
$path = '/feeds/minPlanes/_images/600x600';
$url = 'https://wd.ingrad.ru' . $path;
$dir = '../..' . $path;
if( is_dir(__DIR__ . '/' . $dir) ){
 $dirContents = array_diff(scandir(__DIR__ . '/' . $dir), ['.', '..']);
 foreach($dirContents as $v){
  is_file(__DIR__ . "/{$dir}/{$v}") && ($aPlans[] = "{$url}/{$v}");
 }
}
#> planes

echo "<table>";
foreach($aCRMCodes as $code){
 $plans = '';
 foreach($aPlans as $k => $plan){
  if(
   stripos($plan, (string)$aIds[$code]) !== false
   and stripos($plan, 'floorPlan') === false
  ){
   $plans .= <<<HD
<a href="$plan">$plan</a>

HD;
  }
 }
 echo <<<HD
<tr>
 <td>{$code}</td>
 <td>{$plans}</td>
</tr>

HD;
}
echo "</table>";